<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Dependency Injection Considered <del>Harmful</del> Stupid</title>
  <meta name="description" content="Ever used a dependency injection framework? Yes? In an object oriented language?">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://malumdiscordi.ae/2016/01/15/dependency-injection-considered-harmful-stupid.html">
  <link rel="alternate" type="application/rss+xml" title="Seeds from the Apple of Discord" href="http://malumdiscordi.ae/feed.xml">
  <link href='/stylesheets/all-01211b4eab67ecdce250f9e1cf2d04f7.css' media='all' rel='stylesheet' type='text/css'>
  <link rel="shortcut icon" type="image/png" href="/favicon.png">
</head>

  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Seeds from the Apple of Discord</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">

        <a class="page-link" href="/">Posts</a>

        
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/tag/">Tags</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <a class="page-link" href="/feed.xml">Subscribe</a>

      </div>
    </nav>

  </div>

</header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Dependency Injection Considered <del>Harmful</del> Stupid</h1>
    <p class="post-meta"><time datetime="2016-01-15T10:56:34+01:00" itemprop="datePublished">Jan 15, 2016</time> • tags: <a class="tag_list_link" href="/tag/dependency_injection">dependency_injection</a>, <a class="tag_list_link" href="/tag/programming">programming</a>, <a class="tag_list_link" href="/tag/java">java</a>, <a class="tag_list_link" href="/tag/rant">rant</a></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Ever used a dependency injection framework? Yes? In an object oriented language?</p>

<!--more-->

<p>If it hadn’t been clear before: I dislike object-oriented programming.
Its my personal opinion that OOP is an unecessary overhead <strong>in most cases</strong>. Yes, there might be some systems that benefit from it, but most of the time (see its usage in Java for example) it is exactly that: Abstraction with no benefit.</p>

<p>Now let’s make one thing clear. This opinion is not based on the fact that I haven’t spent much time with OOP or that I am simply better with other paradigms. I have worked several years with OOP and design patterns and clever hierarchies and composition and encapsulation and whatnot - to what effect? Boilerplate code that protects developers from other developers just so nothing in the brittle mess of a system breaks and brings it to fall.</p>

<p><em>Hm. I didn’t want to write about OOP actually… let’s save that for another post.</em></p>

<p>The little introduction, however, was necessary to understand why dependency injection basically is nothing more than a little bit of air-freshener ontop of the unmaintainable pile of s**t that an object-oriented-design most probably produced.</p>

<blockquote>
  <p><strong>DISCLAIMER:</strong> Forgive me for <strong>a)</strong> using Java in this post and <strong>b)</strong> for probably making syntactic mistakes. I use it here because it illustrates its own crappyness pretty nicely, and the mistakes might stem from me luckily not using it very often these days.</p>
</blockquote>

<h3 id="the-idea-of-dependency-injection-di">The idea of dependency injection (DI)</h3>

<p>Suppose you have two objects, Frodo and Sam. <em>(For a real setup, suppose you have 5k classes and around 50k objects)</em> Now, suppose object Frodo depends on object Sam for its initialization. <em>(Again, for a real setup, suppose one of those objects depends on 10 others that each depend on 10 others and so forth)</em> The Frodo object carries the heavy burden of the Ring datastructure, so it needs a supporting companion to take care of the provisions for the long march. <em>(And again, for a real setup, add at least one Gollum dependency as well)</em></p>

<p>What we want to focus on, is how Frodo would get introduced to Sam and the Ring.<br />
Let’s illustrate this unusefully trivial example with a bit of good old Java, and mix in some object-oriented design stuff to make it more obfuscated (and more real…):</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">The Fellowship</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractHobbit</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">protected</span> <span class="n">Integer</span> <span class="n">hungerLevel</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">protected</span> <span class="n">Integer</span> <span class="n">milesWalked</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">// incomplete at this point. might define provision etc.</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Frodo</span> <span class="kd">extends</span> <span class="n">AbstractHobbit</span> <span class="o">&#x7b;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ring</span> <span class="n">theRing</span><span class="o">;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">private</span> <span class="n">AbstractHobbit</span> <span class="n">companion</span><span class="o">;</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">public</span> <span class="n">Frodo</span><span class="o">(</span><span class="n">Ring</span> <span class="n">theRing</span><span class="o">,</span> <span class="n">AbstractHobbit</span> <span class="n">companion</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">this</span><span class="o">.</span><span class="na">theRing</span> <span class="o">=</span> <span class="n">theRing</span><span class="o">;</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">this</span><span class="o">.</span><span class="na">companion</span> <span class="o">=</span> <span class="n">companion</span><span class="o">;</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="o">&#x7d;</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sam</span> <span class="kd">extends</span> <span class="n">AbstractHobbit</span> <span class="o">&#x7b;</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">// let's give Sam a purpose too...</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">private</span> <span class="n">Food</span> <span class="n">provisions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LembasBreadLoaf</span><span class="o">();</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span></div></div></pre></div></figure>

<p><em>Note that I introduced AbstractHobbit, because keeping the code <a href="https://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a> like this is considered a ‘good practice’ in Java… and because it looks funny.</em></p>

<p>Now, in order to wire this up, all you need is an object that knows both Frodo and Sam:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">The Sorcerer</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Gandalf</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">private</span> <span class="n">Hobbit</span> <span class="n">ringBearer</span><span class="o">;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">// for obvious reasons, a Gandalf object is</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">// a loner and doesn't have dependencies!</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">public</span> <span class="n">Gandalf</span><span class="o">()</span> <span class="o">&#x7b;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">Ring</span> <span class="n">theRing</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ring</span><span class="o">();</span> <span class="c1">// actually stolen from Bilbo, but who cares</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// initializing Frodo and Sam *within* a Gandalf</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// might be a bit semantically weird,</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// but we do it for illustrative purposes</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">Sam</span> <span class="n">sam</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sam</span><span class="o">();</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">this</span><span class="o">.</span><span class="na">ringBearer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Frodo</span><span class="o">(</span><span class="n">theRing</span><span class="o">,</span> <span class="n">sam</span><span class="o">);</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="o">&#x7d;</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>This is what is commonly known as manual ‘constructor-based dependency injection’: Instead of letting Frodo create a Sam instance, we have another object that creates a Frodo and ‘injects’ a Sam into it. <em>I just love this metaphor!</em></p>

<p>Generally speaking, you could consider any call to a function and passing of parameters as ‘dependency injection’ - the function depends on its parameters and doesn’t know about how they were created and by whom. This leads to the conclusion that actually, all purely functional programming languages ‘use dependency injection’, or, if you put it the other way round, using dependency injection extensively will make your object-oriented program a bit more functional in some sense. <em>Which is a good thing, IMHO</em></p>

<p>The reason to use this principle or pattern instead of simply creating a Sam inside a Frodo is that the latter is now decoupled from the concrete instance of its companion - it could also be given an instance of a Pippin instead. This makes the Frodo easier to test as you can inject any kind of mocked AbstractHobbit, and it also makes the whole code base easier to maintain, as Frodo doesn’t need to be changed when Sam changes. (Though Gandalf might have to change in that case…)</p>

<h3 id="dependency-injection-frameworks">Dependency-injection frameworks</h3>

<p>Alright, so far so good. Now, let’s do the same thing with Sauron and let him initialize a List of 10000 Orcs with different features, armor, weapons and hierarchies…</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">Sauron and the Orcs</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Orc</span> <span class="kd">extends</span> <span class="n">Creature</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">private</span> <span class="n">Armor</span> <span class="n">armor</span><span class="o">;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">private</span> <span class="n">Weapon</span> <span class="n">weapon</span><span class="o">;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">private</span> <span class="n">Creature</span> <span class="n">boss</span><span class="o">;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">public</span> <span class="n">Orc</span><span class="o">(</span><span class="n">Armor</span> <span class="n">armor</span><span class="o">,</span> <span class="n">Weapon</span> <span class="n">weapon</span><span class="o">,</span> <span class="n">Creature</span> <span class="n">boss</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">this</span><span class="o">.</span><span class="na">armor</span> <span class="o">=</span> <span class="n">armor</span><span class="o">;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">this</span><span class="o">.</span><span class="na">weapon</span> <span class="o">=</span> <span class="n">weapon</span><span class="o">;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">this</span><span class="o">.</span><span class="na">boss</span> <span class="o">=</span> <span class="n">boss</span><span class="o">;</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="o">&#x7d;</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sauron</span> <span class="kd">extends</span> <span class="n">Creature</span> <span class="o">&#x7b;</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">private</span> <span class="n">Orc</span> <span class="n">leader</span><span class="o">;</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Orc</span><span class="o">&gt;</span> <span class="n">orcs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Orc</span><span class="o">&gt;();</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">public</span> <span class="kt">void</span> <span class="n">createOrcs</span><span class="o">()</span> <span class="o">&#x7b;</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// the topmost orc in the hierarchy only reports to us!</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">this</span><span class="o">.</span><span class="na">leader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orc</span><span class="o">(</span><span class="k">new</span> <span class="n">ChainArmor</span><span class="o">(),</span> <span class="k">new</span> <span class="n">WarHorn</span><span class="o">(),</span> <span class="k">this</span><span class="o">);</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// let's give it some minions to play with...</span>
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">orcs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Orc</span><span class="o">(</span><span class="k">new</span> <span class="n">LeatherArmor</span><span class="o">(),</span> <span class="k">new</span> <span class="n">IronAxe</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">leader</span><span class="o">));</span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">orcs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Orc</span><span class="o">(</span><span class="k">new</span> <span class="n">ClothArmor</span><span class="o">(),</span> <span class="k">new</span> <span class="n">LongBow</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">leader</span><span class="o">));</span>
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// ...</span>
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// TODO: continue till orc 10000, and don't forget</span>
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// to include some more sub-hierarchies! Divide et impera, HARR!</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="o">&#x7d;</span>
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>As we see, it takes quite some lines of code to wire up all the Orcs by doing a manual dependency injection here - and don’f forget the Orcs that depend on them, and then the Orcs depend on <em>them</em> and then…</p>

<p>It takes so much code, in fact, that clever people came up with the Idea of abstracting it away by replacing that Sauron object with a somewhat omniscient registry of Orcs and other objects - in the following referred to as Tolkien (or dependency injection framework).</p>

<p>Each Orc object would then declare a list of stuff it needs, go to Tolkien, hand it that list, and get the actual ‘stuff’ back.</p>

<p>Let’s see how this can be done with the help of <a href="https://github.com/google/guice">Guice</a>:</p>

<p>So, all it takes to inject armor, weapon and boss into an Orc now is to place the <code class="highlighter-rouge">@Inject</code> annotation above its constructor and off we go!</p>

<p>Oh wait, thats not true…</p>

<p>Yes, the DI framework can figure out some instance of Armor, Weapon and Boss. But no, it’s not guaranteed to be the instance that we want. What if the Orc object gets the wrong Armor? Or the wrong boss? The battle would be over before it began.</p>

<p>So, necessary configuration doesn’t magically go away by using DI frameworks!</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">The Tedium of Tolkien</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TolkienModule</span> <span class="kd">extends</span> <span class="n">AbstractModule</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="nd">@Override</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">protected</span> <span class="kt">void</span> <span class="n">configure</span><span class="o">()</span> <span class="o">&#x7b;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// this should be filled with bindings from classes</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// to more concrete sub-classes, instances, providers etc.</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// however, we have interdependencies between instances of</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// the same class (Orc) which requires some extra work...</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="o">&#x7d;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">// this provider method will get the Sauron object injected, how cool!</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">// (that is, if we bound it to type Creature and annotated it</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">// with the name "Sauron" in some other DI module)</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="nd">@Provides</span> <span class="nd">@Named</span><span class="o">(</span><span class="s">"Boss"</span><span class="o">)</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">Creature</span> <span class="n">createBoss</span><span class="o">(</span><span class="nd">@Named</span><span class="o">(</span><span class="s">"Sauron"</span><span class="o">)</span> <span class="n">Creature</span> <span class="n">sauron</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">Orc</span> <span class="n">boss</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orc</span><span class="o">(</span><span class="k">new</span> <span class="n">ChainArmor</span><span class="o">(),</span> <span class="k">new</span> <span class="n">WarHorn</span><span class="o">(),</span> <span class="n">sauron</span><span class="o">);</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// looks like a cyclic dependency to me:</span>
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">sauron</span><span class="o">.</span><span class="na">setLeader</span><span class="o">(</span><span class="n">boss</span><span class="o">);</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">return</span> <span class="n">boss</span><span class="o">;</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="o">&#x7d;</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="nd">@Provides</span> <span class="nd">@Named</span><span class="o">(</span><span class="s">"Soldiers"</span><span class="o">)</span>
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">List</span><span class="o">&lt;</span><span class="n">Orc</span><span class="o">&gt;</span> <span class="n">createSoldiers</span><span class="o">(</span><span class="nd">@Named</span><span class="o">(</span><span class="s">"Boss"</span><span class="o">)</span> <span class="n">Creature</span> <span class="n">boss</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">List</span><span class="o">&lt;</span><span class="n">Orc</span><span class="o">&gt;</span> <span class="n">orcs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Orc</span><span class="o">&gt;();</span>
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">orcs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Orc</span><span class="o">(</span><span class="k">new</span> <span class="n">LeatherArmor</span><span class="o">(),</span> <span class="k">new</span> <span class="n">IronAxe</span><span class="o">(),</span> <span class="n">boss</span><span class="o">));</span>
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">orcs</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Orc</span><span class="o">(</span><span class="k">new</span> <span class="n">ClothArmor</span><span class="o">(),</span> <span class="k">new</span> <span class="n">LongBow</span><span class="o">(),</span> <span class="n">boss</span><span class="o">));</span>
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// ...</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// erm. wait a second. we still declare all that stuff explicitly?</span>
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// also, we only have one level of army hierarchy so far...</span>
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// we could probably somehow make this work with nice tools like</span>
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// Multibindings and AssistedInject and FactoryModuleBuilder</span>
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="c1">// but it gives me the chills only thinking about that!</span>
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="33" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">return</span> <span class="n">orcs</span><span class="o">;</span>
</div></div><div data-line="34" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="o">&#x7d;</span>
</div></div><div data-line="35" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>I can’t guarantee that the code above works (it’s incomplete anyways). This specific scenario is generally hard to realize with DI frameworks, since their common use case is more the injection of singleton service-like objects.</p>

<p>What I tried to show, though, is that once you use this or that design pattern or have a more non-standard object dependency hierarchy, you quickly get into the same or worse trouble that you’d get into when injecting the dependencies manually.</p>

<p>Although it looks as if these two approaches have the potential to simplify the initialization of objects in complex dependency-trees, they still both introduce extra code that does all this messy wiring-up.</p>

<p>Why, though? What makes code-decoupling and dependency management so hard? Well, let’s see…</p>

<h3 id="the-root-of-the-evil-spansqrt-1span">The root of the evil <span><script type="math/tex">\sqrt{-1}</script></span></h3>

<p>In the Lord of the Rings, that would be Sauron, but in our case it is something else:<br />
It’s the deficits that come with using abstractions on top of abstractions to handle the complexity imposed by abstractions.</p>

<p>What have we done thus far? No logic. Just boilerplate code and declaring datastructures. We can just as well kick out the earlier, unclutter the code and strip it from its object-oriented parts. Revisit the classes and see what fields they have. I’ll throw in a bit of pseudo code here to make it clearer:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">The Lord of the Rings, Abridged</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">Hobbit</span><span class="pi">:</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">hungerLevel</span><span class="pi">:</span> <span class="s">Integer</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">milesWalked</span><span class="pi">:</span> <span class="s">Integer</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">Frodo</span><span class="pi">:</span> <span class="s">Hobbit with</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">theRing</span><span class="pi">:</span> <span class="s">Ring</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">companion</span><span class="pi">:</span> <span class="s">Hobbit</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">Sam</span><span class="pi">:</span> <span class="s">Hobbit with</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">provisions</span><span class="pi">:</span> <span class="s">Food</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1"># Gandalf is just needed for DI in our example,</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1"># so we leave that out here - it doesnt contain any logic</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">Orc</span><span class="pi">:</span> <span class="s">Creature with</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">armor</span><span class="pi">:</span> <span class="s">Armor</span>
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">weapon</span><span class="pi">:</span> <span class="s">Weapon</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">boss</span><span class="pi">:</span> <span class="s">Creature</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1"># Sauron and Tolkien are left aside as well</span></div></div></pre></div></figure>

<p>For the following we want to consider <code class="highlighter-rouge">Ring</code>, <code class="highlighter-rouge">Food</code>, <code class="highlighter-rouge">Weapon</code> and <code class="highlighter-rouge">Armor</code> to just be more datastructure declarations. Think of them as the ‘stats’ of a weapon or the amount of kalories in the food - it can be as simple as an integer sometimes!</p>

<p>These definitions are all we need for our calculations of the fighting orcs and marching companions who need provisions to stay alive on the way. The rest of the code from the beginning of this post does have no purpose other than filling these fields with data, in an environment where it is (seemingly) hard and complicated to do so. It does not even implement any of the logic of marching and fighting, just the abstract realtionships between objects like Frodo and Sam.<br />Actually, for our scenario, we might argue that it is not even important to know about the relationship of those two, and might just consider them as one unit like so:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">The Baggins/Gamgee Complex</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">Companions</span><span class="pi">:</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">hungerLevel</span><span class="pi">:</span> <span class="s">Integer</span> <span class="c1"># they hunger together</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">milesWalked</span><span class="pi">:</span> <span class="s">Integer</span> <span class="c1"># they march together</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">theRing</span><span class="pi">:</span> <span class="s">Ring</span>        <span class="c1"># ...hm...</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s">provisions</span><span class="pi">:</span> <span class="s">Food</span>     <span class="c1"># and they share their bread</span></div></div></pre></div></figure>

<p>This might be counter intuitive. But as a developer we know the whole story. We can decide what kind of datastructure still obeys the semantics and makes implementing the business logic as simple as possible. By doing so, we can avoid complex dependencies right from the start, and filling these few fields with data initially is also not very difficult.<br />
Remember that this initial configuration (especially if we are dealing with something as diverse as the orc-army) is <strong>almost always</strong> required and no tool can make it magically disappear.</p>

<p>That’s a good thing! If you know what kind of data is fed into a program when it starts, you have a better chance of understanding the behaviour of it! If that data is split into pieces, mixed with logic and spread all over the object-tree though, constantly changing and producing states that are complex to trace and understand, then you easily end up in an unmaintainable mess of a project. Throwing a DI framework onto that might help in some cases, but why not making it less complex right from the start?</p>

<p><em>Note at this point that you can <strong>always</strong> refactor code to contain <strong>either</strong> logic <strong>or</strong> datastructures, so defining something like the example above is not impossible under real conditions. The only reason why we didn’t do it right from the start is because OOP is all about mixing up data and logic.</em></p>

<p>In a nutshell, if you’re using DI because you think it is crucial for a project to be maintainable in the long run, you’re probably not doing something harmful, but simply something unecessary. That’s not because DI is intrinsically bad, but because the weird principles of OOP force you to use something like that to manage all the dependencies of your objects. In carefully designing the datastructures outside of the context of an object, it might, however, be possible to avoid all that. So why not using a simpler, more data-oriented approach instead?</p>

<p><em>For the OOP &amp; DI lovers: If you find this post offensive, you probably suffer from a phenomenon known as the ‘<a href="https://en.wikipedia.org/wiki/Law_of_the_instrument">golden hammer</a>’. Please take some time and think the arguments through. A classical program is never more than data-input -&gt; computation -&gt; data-output.</em></p>

<p>And some famous last words: I’ll give an example of a useful data-oriented functional implementation of the situation described above in a follow-up post, promised! In the meantime, I recommend reading <a href="http://gamesfromwithin.com/data-oriented-design">Noel’s article</a> about further aspects of data-oriented design, like performance gain - especially for games.</p>


    <br/><hr/><br/>

    
    <div>Now you can: Comment below & <a href="https://twitter.com/intent/tweet?url=http://malumdiscordi.ae/2016/01/15/dependency-injection-considered-harmful-stupid.html&text=Dependency Injection Considered <del>Harmful</del> Stupid&via=ephe_meral" target="_blank">Tweet this</a> or <a href="https://twitter.com/ephe_meral">follow me!</a></div>
    
  </div>

  <div id="disqus_thread"></div>
<script>
    //var disqus_developer = 1; // Comment out when the site is live
    var disqus_config = function () {
      this.shortname = "malumdiscordiae";
      this.page.url = "http://malumdiscordi.ae/2016/01/15/dependency-injection-considered-harmful-stupid.html";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2016/01/15/dependency-injection-considered-harmful-stupid"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() {  // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = '//malumdiscordiae.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Seeds from the Apple of Discord</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li><p>Johanna Appel's musings about the world, science & technology, programming, languages, music, art, learning and absurdities.
</p></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="mailto:malumdiscordiae@mailbox.org"><span class="icon icon--email"><?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.4, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="216px" height="146px" viewBox="20 20 176 106" xml:space="preserve">
<g>
	<path d="M49.013,51.003c1.847,1.303,7.414,5.174,16.702,11.61S82.118,74.005,87.061,77.48c0.543,0.381,1.697,1.209,3.462,2.485
		c1.765,1.277,3.232,2.31,4.399,3.097c1.168,0.787,2.58,1.67,4.237,2.647c1.657,0.977,3.219,1.711,4.685,2.198
		c1.467,0.49,2.825,0.733,4.074,0.733H108h0.082c1.249,0,2.607-0.243,4.074-0.733c1.466-0.487,3.029-1.222,4.685-2.198
		c1.656-0.978,3.068-1.86,4.236-2.647s2.634-1.82,4.399-3.097s2.92-2.104,3.463-2.485c4.996-3.476,17.707-12.302,38.129-26.479
		c3.965-2.769,7.277-6.11,9.939-10.021C179.67,37.071,181,32.97,181,28.679c0-3.585-1.291-6.654-3.871-9.207
		c-2.58-2.553-5.636-3.829-9.165-3.829H48.035c-4.182,0-7.4,1.412-9.654,4.236C36.127,22.704,35,26.235,35,30.471
		c0,3.422,1.494,7.13,4.481,11.122S45.646,48.722,49.013,51.003z"/>
	<path d="M172.852,59.72c-17.814,12.057-31.34,21.427-40.572,28.108c-3.096,2.281-5.608,4.061-7.537,5.336
		c-1.928,1.277-4.494,2.58-7.699,3.911c-3.204,1.331-6.191,1.996-8.961,1.996H108h-0.082c-2.77,0-5.758-0.665-8.962-1.996
		s-5.771-2.634-7.699-3.911c-1.928-1.275-4.44-3.055-7.536-5.336c-7.333-5.377-20.83-14.747-40.492-28.108
		c-3.096-2.063-5.839-4.427-8.229-7.088v64.688c0,3.586,1.276,6.654,3.829,9.207c2.553,2.554,5.622,3.83,9.207,3.83h119.929
		c3.584,0,6.653-1.276,9.206-3.83c2.554-2.554,3.829-5.621,3.829-9.207V52.632C178.664,55.238,175.949,57.602,172.852,59.72z"/>
</g>
</svg></span><span class="username">mailbox</span></a>
          </li>
          
          
          <li>
            <a href="https://github.com/ephe-meral"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg></span><span class="username">ephe-meral</span></a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/ephe_meral"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg></span><span class="username">ephe_meral</span></a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a><br />licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
      </div>
    </div>

  </div>

</footer>

    <div class="ribbon">
      <a href="https://github.com/ephe-meral/ephe-meral.github.io">Hosted on GitHub</a>
    </div>

    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script id="dsq-count-scr" src="//malumdiscordiae.disqus.com/count.js" async></script>

  </body>

</html>
